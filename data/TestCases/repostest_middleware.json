{
    "functionName": "test_middleware",
    "className": null,
    "fileName": "/TeamHG-Memex_&_MaybeDont/tests_&_test_middleware.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "Rq = lambda path: Request('http://example.com{}'.format(path), meta={\n    'avoid_dup_content': True})\nRs = lambda req, body: HtmlResponse(req.url, body=body.encode(), request=req)\nmw = AvoidDupContentMiddleware(initial_queue_limit=1, threshold=0.5,\n    exploration=0.0)\nspider = Spider()\nreq = Rq('/')\nmw.process_request(req, spider)\nmw.process_response(req, Rs(req, ''), spider)\nassert mw.dupe_predictor\nn_dropped = 0\nfor i in range(10):\n    req = Rq('/viewtopic.php?topic_id={}'.format(i))\n    mw.process_request(req, spider)\n    mw.process_response(req, Rs(req, 'Topic {}'.format(i)), spider)\n    req = Rq('/viewtopic.php?topic_id={}&start=0'.format(i))\n    try:\n        mw.process_request(req, spider)\n    except IgnoreRequest:\n        n_dropped += 1\n    else:\n        mw.process_response(req, Rs(req, 'Topic {}'.format(i)), spider)\n    mw.dupe_predictor.log_dupstats(min_dup=0)\nassert n_dropped == 5\nreq = Rq('/viewtopic.php?topic_id=100&start=0')\nmw.process_request(req, spider)\nmw.process_response(req, Rs(req, ''), spider)\nmw.process_request(Rq('/viewtopic.php?topic_id=200'), spider)\nwith pytest.raises(IgnoreRequest):\n    mw.process_request(Rq('/viewtopic.php?topic_id=100'), spider)\nmw.exploration = 0.5\nn_dropped = 0\nn_requests = 0\nfor i in range(150, 170):\n    req = Rq('/viewtopic.php?topic_id={}'.format(i))\n    mw.process_request(req, spider)\n    mw.process_response(req, Rs(req, 'Topic {}'.format(i)), spider)\n    req = Rq('/viewtopic.php?topic_id={}&start=0'.format(i))\n    n_requests += 1\n    try:\n        mw.process_request(req, spider)\n    except IgnoreRequest:\n        n_dropped += 1\n    else:\n        mw.process_response(req, Rs(req, 'Topic {}'.format(i)), spider)\nassert n_dropped > 0\nassert n_dropped < n_requests\n"
}
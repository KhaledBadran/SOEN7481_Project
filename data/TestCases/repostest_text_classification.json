{
    "functionName": "test_text_classification",
    "className": "TestBackend",
    "fileName": "/intel-analytics_&_Bigdl/pyspark_&_test_&_bigdl_&_keras_&_test_backend.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "\"\"\"This example demonstrates the use of Convolution1D for text classification.\n           This example is from Keras\n        \"\"\"\nimport numpy as np\nnp.random.seed(1337)\nfrom keras.preprocessing import sequence\nfrom keras.models import Sequential\nfrom keras.layers import Dense, Dropout, Activation\nfrom keras.layers import Embedding\nfrom keras.layers import Convolution1D\nfrom keras.datasets import imdb\nmax_features = 5000\nmaxlen = 400\nbatch_size = 32\nembedding_dims = 50\nnb_filter = 250\nfilter_length = 3\nhidden_dims = 250\nnb_epoch = 2\nprint('Loading data...')\n(X_train, y_train), (X_test, y_test) = imdb.load_data(nb_words=max_features)\nprint(len(X_train), 'train sequences')\nprint(len(X_test), 'test sequences')\nprint('Pad sequences (samples x time)')\nX_train = sequence.pad_sequences(X_train, maxlen=maxlen)\nX_test = sequence.pad_sequences(X_test, maxlen=maxlen)\nprint('X_train shape:', X_train.shape)\nprint('X_test shape:', X_test.shape)\nprint('Build model...')\nmodel = Sequential()\nmodel.add(Embedding(max_features, embedding_dims, input_length=maxlen))\nmodel.add(Convolution1D(nb_filter=nb_filter, filter_length=filter_length,\n    border_mode='valid', activation='relu', subsample_length=1))\nmodel.add(GlobalMaxPooling1D())\nmodel.add(Dense(hidden_dims))\nmodel.add(Dropout(0.2))\nmodel.add(Activation('relu'))\nmodel.add(Dense(1))\nmodel.add(Activation('sigmoid'))\nmodel.compile(loss='binary_crossentropy', optimizer='adam', metrics=[\n    'accuracy'])\nmodel = with_bigdl_backend(model)\nmodel.fit(X_train, y_train, batch_size=batch_size, nb_epoch=nb_epoch,\n    validation_data=(X_test, y_test))\nmodel.predict(X_test)\nmodel.evaluate(X_test, y_test)\nprint(model)\npytest.mark.skip(reason=\n    'need to support evaluate locally before running the test')"
}
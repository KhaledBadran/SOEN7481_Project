{
    "functionName": "test_run_TPI_full_run",
    "className": null,
    "fileName": "/open-source-economics_&_OG-USA/ogusa_&_tests_&_test_TPI.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "\"\"\"\n    Test TPI.run_TPI function.  Provide inputs to function and\n    ensure that output returned matches what it has been before.\n    \"\"\"\nbaseline_dir = os.path.join(CUR_PATH, 'baseline')\nif baseline:\n    output_base = baseline_dir\nelse:\n    output_base = os.path.join(CUR_PATH, 'reform')\np = Specifications(baseline=baseline, baseline_dir=baseline_dir,\n    output_base=output_base, client=dask_client, num_workers=NUM_WORKERS)\np.update_specifications(param_updates)\np.get_tax_function_parameters(None, run_micro=False, tax_func_path=os.path.\n    join(CUR_PATH, '..', 'data', 'tax_functions', 'TxFuncEst_baseline_CPS.pkl')\n    )\nSS.ENFORCE_SOLUTION_CHECKS = False\nss_outputs = SS.run_SS(p, None)\nif p.baseline:\n    utils.mkdirs(os.path.join(p.baseline_dir, 'SS'))\n    ss_dir = os.path.join(p.baseline_dir, 'SS', 'SS_vars.pkl')\n    with open(ss_dir, 'wb') as f:\n        pickle.dump(ss_outputs, f)\nelse:\n    utils.mkdirs(os.path.join(p.output_base, 'SS'))\n    ss_dir = os.path.join(p.output_base, 'SS', 'SS_vars.pkl')\n    with open(ss_dir, 'wb') as f:\n        pickle.dump(ss_outputs, f)\ntest_dict = TPI.run_TPI(p, None)\nexpected_dict = utils.safe_read_pickle(filename)\nfor k, v in expected_dict.items():\n    try:\n        assert np.allclose(test_dict[k][:p.T], v[:p.T], rtol=0.0001, atol=\n            0.0001)\n    except ValueError:\n        assert np.allclose(test_dict[k][:p.T, :, :], v[:p.T, :, :], rtol=\n            0.0001, atol=0.0001)\npytest.mark.full_runpytest.mark.parametrize('baseline,param_updates,filename', [(True,\n    param_updates2, filename2), (True, param_updates1, filename1), (False,\n    param_updates3, filename3), (False, param_updates4, filename4), (True,\n    param_updates5, filename5), (True, param_updates6, filename6), (True,\n    param_updates7, filename7)], ids=['Baseline, balanced budget',\n    'Baseline', 'Reform', 'Reform, baseline spending',\n    'Baseline, small open', 'Baseline, small open some periods',\n    'Baseline, delta_tau = 0'])"
}
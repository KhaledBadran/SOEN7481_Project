{
    "functionName": "test_high_res_cor_matrix",
    "className": null,
    "fileName": "/MetaSys-LISBP_&_IsoCor/isocor_&_tests_&_test_correction_matrix_HighRes_resolved.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "\"\"\"Correction of high-resolution MS data.\n\n    Test calculates the correction matrix of labeled metabolites containing C, H, N and O elements,\n    and compares this matrix to a theoretical matrix.\n    \"\"\"\nmetabolite = hrcor.HighResMetaboliteCorrector(data['formula'], data[\n    'tracer'], data_isotopes=data_iso, correct_NA_tracer=data[\n    'correct_NA_tracer'], resolution_formula_code='orbitrap', tracer_purity\n    =data['tracer_purity'], resolution=data['resolution'], mz_of_resolution\n    =data['mz_of_resolution'], derivative_formula=data['derivative_formula'\n    ], charge=1)\ncorrection_matrix = metabolite.compute_correction_matrix()\np1H = data_iso['H']['abundance'][0]\np2H = data_iso['H']['abundance'][1]\np12C = data_iso['C']['abundance'][0]\np13C = data_iso['C']['abundance'][1]\np14N = data_iso['N']['abundance'][0]\np15N = data_iso['N']['abundance'][1]\np16O = data_iso['O']['abundance'][0]\np17O = data_iso['O']['abundance'][1]\np18O = data_iso['O']['abundance'][2]\npur_12C = data['tracer_purity'][0]\npur_13C = data['tracer_purity'][1]\npur1H = data['tracer_purity'][0]\npur2H = data['tracer_purity'][1]\nexpected_matrix = eval(data['expected_matrix'])\nnp.testing.assert_allclose(correction_matrix, expected_matrix, rtol=\n    usr_tolerance)\npytest.mark.parametrize('data', [{'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 3 isotopes, 17O and 18O are resolved'\n    , 'formula': 'C2O2P10', 'tracer': '13C', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p16O**2, 0.0, 0.0], [0.0, p16O**2, 0.0], [0.0, 0.0, p16O**2]]',\n    'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'tracer': '13C', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p1H**2, 0.0, 0.0], [0.0, p1H**2, 0.0], [0.0, 0.0, p1H**2]]',\n    'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, with NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'tracer': '13C', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    True, 'expected_matrix':\n    '[[p1H**2*p12C**2, 0.0, 0.0], [2*p12C*p13C*p1H**2, p1H**2*p12C, 0.0], [p1H**2*p13C**2, p1H**2*p13C, p1H**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 2 elements with 2 isotopes'\n    , 'formula': 'C2H2N2P10', 'tracer': '13C', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p1H**2*p14N**2, 0.0, 0.0], [0.0, p1H**2*p14N**2, 0.0], [0.0, 0.0, p1H**2*p14N**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, with purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'tracer': '13C', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p1H**2, p1H**2*pur_12C, p1H**2*pur_12C*pur_12C], [0.0, p1H**2*pur_13C, p1H**2*pur_12C*pur_13C*2], [0.0, 0.0, p1H**2*pur_13C*pur_13C]]'\n    , 'tracer_purity': [0.1, 0.9]}, {'comment':\n    '17O tracer, no derivative, no NA of the tracer element, with purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'O', 'tracer': '17O', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    True, 'expected_matrix': '[[p16O, 0.0], [p17O, 0.0]]', 'tracer_purity':\n    [0.0, 0.0, 1.0]}, {'comment':\n    '17O tracer, no derivative, NA of the tracer element, no purity of the tracer element, tracer with 3 isotopes, correct for NA of 0 elements'\n    , 'formula': 'O', 'tracer': '17O', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    True, 'expected_matrix': '[[p16O, 0.0], [p17O, 1.0]]', 'tracer_purity':\n    [0.0, 1.0, 0.0]}, {'comment':\n    '17O tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 3 isotopes, correct for NA of 0 elements'\n    , 'formula': 'O1', 'tracer': '17O', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix': '[[1.0, 0.0], [0.0, 1.0]]', 'tracer_purity':\n    [0.0, 1.0, 0.0]}, {'comment':\n    '17O tracer, no derivative, no NA of the tracer element, with purity of the tracer element, tracer with 3 isotopes, correct for NA of 0 elements'\n    , 'formula': 'O1', 'tracer': '17O', 'derivative_formula': '',\n    'resolution': 1000000.0, 'mz_of_resolution': 400, 'correct_NA_tracer': \n    False, 'expected_matrix': '[[1.0, 0.1], [0.0, 0.9]]', 'tracer_purity':\n    [0.1, 0.9, 0.0]}])"
}
{
    "functionName": "test_ParamQuantEstimation_3",
    "className": null,
    "fileName": "/NSLS-II_&_PyXRF/pyxrf_&_core_&_tests_&_test_quant_analysis.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "standard_data = _standard_data_sample\nhome_dir = tmp_path\nconfig_dir = '.pyxrf'\nstandards_fln = 'quantitative_standards.yaml'\nfile_path = os.path.join(home_dir, config_dir, standards_fln)\nsave_xrf_standard_yaml_file(file_path, standard_data)\npqe = ParamQuantEstimation(home_dir=home_dir)\npqe.load_standards()\nincident_energy = 12.0\nimg = gen_xrf_map_dict()\npqe.set_selected_standard()\npqe.gen_fluorescence_data_dict(incident_energy=incident_energy)\nscaler_name = 'sclr'\npqe.fill_fluorescence_data_dict(xrf_map_dict=img, scaler_name=scaler_name)\nqfdd = get_quant_fluor_data_dict(standard_data[0], incident_energy)\nfill_quant_fluor_data_dict(qfdd, xrf_map_dict=img, scaler_name=scaler_name)\nassert pqe.fluorescence_data_dict == qfdd, 'The filled fluorescence data dictionary does not match the expected'\npview = pqe.get_fluorescence_data_dict_text_preview()\nassert 'WARNING:' in pview, 'Warning is not found in preview'\npview = pqe.get_fluorescence_data_dict_text_preview(enable_warnings=False)\nassert pview.count('WARNING:'\n    ) == 0, 'Warnings are disabled, but still generated'\npqe.set_detector_channel_in_data_dict(detector_channel='sum')\nassert pqe.fluorescence_data_dict['detector_channel'\n    ] == 'sum', 'Detector channel was not set correctly'\ndistance_to_sample = 2.5\npqe.set_distance_to_sample_in_data_dict(distance_to_sample=distance_to_sample)\nassert pqe.fluorescence_data_dict['distance_to_sample'\n    ] == distance_to_sample, 'Distance-to-sample was not set correctly'\nscan_id = 65476\nscan_uid = 'abcdef-12345678'\nqfdd = copy.deepcopy(pqe.fluorescence_data_dict)\npqe.set_optional_parameters(scan_id=scan_id, scan_uid=scan_uid)\nset_quant_fluor_data_dict_optional(qfdd, scan_id=scan_id, scan_uid=scan_uid)\nqfdd['creation_time_local'] = pqe.fluorescence_data_dict['creation_time_local']\nassert pqe.fluorescence_data_dict == qfdd, 'Optional parameters are not set correctly'\npview = pqe.get_fluorescence_data_dict_text_preview()\nassert 'WARNING:' not in pview, 'Preview must contain no warnings'\nfln_suggested = pqe.get_suggested_json_fln()\nassert f\"_{pqe.fluorescence_data_dict['serial']}.\" in fln_suggested, f'Serial of the reference is not found in the suggested file name {fln_suggested}'\nfile_path = os.path.join(tmp_path, fln_suggested)\npqe.save_fluorescence_data_dict(file_path=file_path)\nqfdd = load_xrf_quant_fluor_json_file(file_path=file_path)\nassert qfdd == prune_quant_fluor_data_dict(pqe.fluorescence_data_dict\n    ), \"Error occurred while saving and loading calibration data dictionary. Dictionaries don't match\"\n"
}
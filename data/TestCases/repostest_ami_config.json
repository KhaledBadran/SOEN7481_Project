{
    "functionName": "test_ami_config",
    "className": "TestAMIConfig",
    "fileName": "/capn-freako_&_PyAMI/tests_&_test_ami_config.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "\"\"\"Using the example_tx.py and supporting cpp.em file verify the output.\"\"\"\nmock_date.today.return_value = '2019-02-10'\nfrom pyibisami.ami_config import ami_config\nami_config(Path(__file__).parent.joinpath('examples', 'example_tx.py'))\nwith open(Path(__file__).parent.joinpath('examples', 'example_tx.ami')\n    ) as ami_file:\n    ami = ami_file.read()\n    assert ami == \"\"\"(example_tx\n\n    (Description \"Example Tx model from ibisami package.\")\n\n    (Reserved_Parameters\n         (AMI_Version\n             (Usage Info )\n             (Type String )\n             (Value \"5.1\" )\n             (Description \"Version of IBIS standard we comply with.\" )\n         )\n         (Init_Returns_Impulse\n             (Usage Info )\n             (Type Boolean )\n             (Value True )\n             (Description \"In fact, this model is, currently, Init-only.\" )\n         )\n         (GetWave_Exists\n             (Usage Info )\n             (Type Boolean )\n             (Value True )\n             (Description \"This model is dual-mode, with GetWave() mimicking Init().\" )\n         )\n    )\n    (Model_Specific\n         (tx_tap_units\n             (Usage In )\n             (Type Integer )\n             (Range 27 6 27 )\n             (Description \"Total current available to FIR filter.\" )\n         )\n         (tx_tap_np1\n             (Usage In )\n             (Type Integer )\n             (Range 0 0 10 )\n             (Description \"First (and only) pre-tap.\" )\n         )\n         (tx_tap_nm1\n             (Usage In )\n             (Type Integer )\n             (Range 0 0 10 )\n             (Description \"First post-tap.\" )\n         )\n         (tx_tap_nm2\n             (Usage In )\n             (Type Integer )\n             (Range 0 0 10 )\n             (Description \"Second post-tap.\" )\n         )\n    )\n\n)\n\n\"\"\"\nwith open(Path(__file__).parent.joinpath('examples', 'example_tx.ibs')\n    ) as ibis_file:\n    ibis = ibis_file.read()\n    assert ibis == \"\"\"[IBIS Ver]   5.1\n\n\n\n[File Name]  example_tx.ibs\n[File Rev]   v0.1\n\n[Date]       2019-02-10\n\n[Source]     ibisami, a public domain IBIS-AMI model creation infrastructure\n\n[Disclaimer]\nTHIS MODEL IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS MODEL, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n[Notes]\nThis IBIS file was generated, using the template file,\n\"example_tx.ibs.em\", from ibisami, a public domain IBIS-AMI model\ncreation infrastructure. To learn more, visit:\n\nhttps://github.com/capn-freako/ibisami/wiki\n\n[Copyright]    Copyright (c) 2016 David Banas; all rights reserved World wide.\n[Component]    Example_Tx\n[Manufacturer] (n/a)\n\n[Package]\n\nR_pkg     0.10     0.00     0.50\nL_pkg    10.00n    0.10n   50.00n\nC_pkg     1.00p    0.01p    5.00p\n\n\n[Pin]  signal_name        model_name            R_pin  L_pin  C_pin\n1p     Tx_1_P             example_tx\n1n     Tx_1_N             example_tx\n2p     Tx_2_P             example_tx\n2n     Tx_2_N             example_tx\n3p     Tx_3_P             example_tx\n3n     Tx_3_N             example_tx\n\n[Diff_Pin] inv_pin vdiff tdelay_typ tdelay_min tdelay_max\n1p           1n     0.1V     NA         NA         NA\n2p           2n     0.1V     NA         NA         NA\n3p           3n     0.1V     NA         NA         NA\n\n[Model]   example_tx\nModel_type   Output\n\nC_comp     1.00p    0.01p    5.00p\nCref  = 0\nVref  = 0.5\nVmeas = 0.5\nRref  = 50\n\n\n[Algorithmic Model]\nExecutable linux_gcc4.1.2_32          example_tx_x86.so         example_tx.ami\nExecutable linux_gcc4.1.2_64          example_tx_x86_amd64.so   example_tx.ami\nExecutable Windows_VisualStudio_32    example_tx_x86.dll        example_tx.ami\nExecutable Windows_VisualStudio_64    example_tx_x86_amd64.dll  example_tx.ami\n[End Algorithmic Model]\n\n[Temperature_Range]     25.0      0.0    100.0\n[Voltage_Range]         1.80     1.62     1.98\n\n\n[Pulldown]\n-1.80    -1.000e+01    -1.000e+01    -1.000e+01\n0.00     0.000e+00     0.000e+00     0.000e+00 \n1.80     3.600e-02     4.000e-02     3.273e-02 \n3.60     1.000e+01     1.000e+01     1.000e+01 \n[Pullup]\n-1.80    1.000e+01     1.000e+01     1.000e+01 \n0.00     -0.000e+00    -0.000e+00    -0.000e+00\n1.80     -3.600e-02    -4.000e-02    -3.273e-02\n3.60     -1.000e+01    -1.000e+01    -1.000e+01\n[Ramp]\ndV/dt_r    0.540/108.00p    0.512/511.58p    0.566/56.57p\ndV/dt_f    0.540/108.00p    0.512/511.58p    0.566/56.57p\n\n\n\n[END]\n\n\"\"\"\nwith open(Path(__file__).parent.joinpath('examples', 'example_tx.cpp')\n    ) as cpp_file:\n    cpp = cpp_file.read()\n    assert cpp == \"\"\"/** \\\\file example_tx.cpp\n *  \\\\brief Example of using ibisami to build a Tx model.\n *\n * Original author: David Banas <br>\n * Original date:   May 8, 2015\n * Initial conversion to EmPy template format: Feb 25, 2016\n *\n * Copyright (c) 2015 David Banas; all rights reserved World wide.\n */\n\n#define TAP_SCALE 0.0407\n\n#include <string>\n#include <vector>\n#include \"include/ami_tx.h\"\n\n/// An example device specific Tx model implementation.\nclass MyTx : public AmiTx {\n    typedef AmiTx inherited;\n\n public:\n    MyTx() {}\n    ~MyTx() {}\n    void init(double *impulse_matrix, const long number_of_rows,\n            const long aggressors, const double sample_interval,\n            const double bit_time, const std::string& AMI_parameters_in) override {\n\n        // Let our base class do its thing.\n        inherited::init(impulse_matrix, number_of_rows, aggressors,\n            sample_interval, bit_time, AMI_parameters_in);\n\n        // Grab our parameters and configure things accordingly.\n        std::vector<std::string> node_names; node_names.clear();\n        std::ostringstream msg;\n\n        msg << \"Initializing Tx...\\\\n\";\n\n        int taps[4];\n        int tx_tap_units ;\n        node_names.push_back(\"tx_tap_units\");\n        tx_tap_units = get_param_int(node_names, 27 );\n        node_names.pop_back();\n        int tx_tap_np1 ;\n        node_names.push_back(\"tx_tap_np1\");\n        tx_tap_np1 = get_param_int(node_names, 0 );\n        taps[0] = tx_tap_np1;\n        node_names.pop_back();\n        int tx_tap_nm1 ;\n        node_names.push_back(\"tx_tap_nm1\");\n        tx_tap_nm1 = get_param_int(node_names, 0 );\n        taps[2] = tx_tap_nm1;\n        node_names.pop_back();\n        int tx_tap_nm2 ;\n        node_names.push_back(\"tx_tap_nm2\");\n        tx_tap_nm2 = get_param_int(node_names, 0 );\n        taps[3] = tx_tap_nm2;\n        node_names.pop_back();\n\n        taps[1] = tx_tap_units - (taps[0] + taps[2] + taps[3]);\n        if ( (tx_tap_units - 2 * (taps[0] + taps[2] + taps[3])) < 6 )\n            msg << \"WARNING: Illegal Tx pre-emphasis tap configuration!\\\\n\";\n\n        // Fill in params_.\n        std::ostringstream params;\n        params << \"(example_tx\";\n        params << \" (tx_tap_units \" << tx_tap_units << \")\";\n        params << \" (taps[0] \" << taps[0] << \")\";\n        params << \" (taps[1] \" << taps[1] << \")\";\n        params << \" (taps[2] \" << taps[2] << \")\";\n        params << \" (taps[3] \" << taps[3] << \")\";\n\n        tap_weights_.clear();\n        int samples_per_bit = int(bit_time / sample_interval);\n        int tap_signs[] = {-1, 1, -1, -1};\n        have_preemph_ = true;\n        for (auto i = 0; i <= 3; i++) {\n            tap_weights_.push_back(taps[i] * TAP_SCALE * tap_signs[i]);\n            params << \" (tap_weights_[\" << i << \"] \" << tap_weights_.back() << \")\";\n            for (auto j = 1; j < samples_per_bit; j++)\n                tap_weights_.push_back(0.0);\n        }\n        param_str_ = params.str() + \"\\\\n\";\n        msg_ = msg.str() + \"\\\\n\";\n    }\n} my_tx;\n\nAMIModel *ami_model = &my_tx;  ///< The pointer required by the API implementation.\n\n\"\"\"\nPath(__file__).parent.joinpath('examples', 'example_tx.ami').unlink()\nPath(__file__).parent.joinpath('examples', 'example_tx.ibs').unlink()\nPath(__file__).parent.joinpath('examples', 'example_tx.cpp').unlink()\npatch.object(ami_config, 'date', autospec=True)"
}
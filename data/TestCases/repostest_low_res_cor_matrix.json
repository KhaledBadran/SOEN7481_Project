{
    "functionName": "test_low_res_cor_matrix",
    "className": null,
    "fileName": "/MetaSys-LISBP_&_IsoCor/isocor_&_tests_&_test_correction_matrix_LowRes.py",
    "projectName": "repos",
    "Label": false,
    "isTest": true,
    "Body": "\"\"\"Correction of low resolution MS data.\n\n    Test simulates the correction of C2 compounds in a 13C-tracer experiment.\n    \"\"\"\nmetabolite = hrcor.LowResMetaboliteCorrector(data['formula'], '13C',\n    data_isotopes=data_iso, correct_NA_tracer=data['correct_NA_tracer'],\n    tracer_purity=data['tracer_purity'], derivative_formula=data[\n    'derivative_formula'])\ncorrection_matrix = metabolite.compute_correction_matrix()\np1H = data_iso['H']['abundance'][0]\np2H = data_iso['H']['abundance'][1]\np12C = data_iso['C']['abundance'][0]\np13C = data_iso['C']['abundance'][1]\np14N = data_iso['N']['abundance'][0]\np15N = data_iso['N']['abundance'][1]\np16O = data_iso['O']['abundance'][0]\np17O = data_iso['O']['abundance'][1]\np18O = data_iso['O']['abundance'][2]\npur_12C = data['tracer_purity'][0]\npur_13C = data['tracer_purity'][1]\nexpected_matrix = eval(data['expected_matrix'])\nnp.testing.assert_allclose(correction_matrix, expected_matrix, rtol=\n    usr_tolerance)\npytest.mark.parametrize('data', [{'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 3 isotopes'\n    , 'formula': 'C2O2P10', 'derivative_formula': '', 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p16O**2, 0.0, 0.0], [p17O*p16O*2, p16O**2, 0.0], [p17O*p17O+p18O*p16O*2, p17O*p16O*2, p16O**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'derivative_formula': '', 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p1H**2, 0.0, 0.0], [2*p1H*p2H, p1H**2, 0.0], [p2H**2, 2*p1H*p2H, p1H**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, with NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'derivative_formula': '', 'correct_NA_tracer': \n    True, 'expected_matrix':\n    '[[p1H**2*p12C**2, 0.0, 0.0], [2*p1H*p2H*p12C**2+2*p12C*p13C*p1H**2, p1H**2*p12C, 0.0], [p2H**2*p12C**2+2*p12C*p13C*p1H*p2H*2+p1H**2*p13C**2, p12C*p1H*p2H*2+p1H**2*p13C, p1H**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 2 elements with 2 isotopes'\n    , 'formula': 'C2H2N2P10', 'derivative_formula': '', 'correct_NA_tracer':\n    False, 'expected_matrix':\n    '[[p1H**2*p14N**2, 0.0, 0.0], [2*p1H*p2H*p14N**2+2*p14N*p15N*p1H**2, p1H**2*p14N**2, 0.0], [p2H**2*p14N**2+2*p14N*p15N*p1H*p2H*2+p1H**2*p15N**2, 2*p1H*p2H*p14N**2+2*p14N*p15N*p1H**2, p1H**2*p14N**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, no derivative, no NA of the tracer element, with purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'derivative_formula': '', 'correct_NA_tracer': \n    False, 'expected_matrix':\n    '[[p1H**2, p1H**2*pur_12C, p1H**2*pur_12C*pur_12C], [2*p1H*p2H, p1H**2*pur_13C+2*p1H*p2H*pur_12C, p1H**2*pur_12C*pur_13C*2+2*p1H*p2H*pur_12C*pur_12C], [p2H**2, 2*p1H*p2H*pur_13C+p2H**2*pur_12C, p2H**2*pur_12C*pur_12C+p1H**2*pur_13C*pur_13C+p1H*p2H*2*pur_13C*pur_12C*2]]'\n    , 'tracer_purity': [0.1, 0.9]}, {'comment':\n    '13C tracer, with derivative, no NA of the tracer element, no purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'derivative_formula': 'C2', 'correct_NA_tracer':\n    False, 'expected_matrix':\n    '[[p1H**2*p12C**2, 0.0, 0.0], [2*p1H*p2H*p12C**2+2*p12C*p13C*p1H**2, p1H**2*p12C**2, 0.0], [p2H**2*p12C**2+2*p12C*p13C*p1H*p2H*2+p1H**2*p13C**2, 2*p1H*p2H*p12C**2+2*p12C*p13C*p1H**2, p1H**2*p12C**2]]'\n    , 'tracer_purity': [0.0, 1.0]}, {'comment':\n    '13C tracer, with derivative, no NA of the tracer element, with purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2H2P10', 'derivative_formula': 'C2', 'correct_NA_tracer':\n    False, 'expected_matrix':\n    '[[p1H**2*p12C**2, pur_12C*(p1H**2*p12C**2), p1H**2*p12C**2*pur_12C*pur_12C], [2*p1H*p2H*p12C**2 + 2*p12C*p13C*p1H**2, pur_13C*(p1H**2*p12C**2) + pur_12C*(2*p1H*p2H*p12C**2 + 2*p12C*p13C*p1H**2), pur_13C*(pur_12C*(p1H**2*p12C**2)) + pur_12C*(pur_13C*(p1H**2*p12C**2) + pur_12C*(2*p1H*p2H*p12C**2 + 2*p12C*p13C*p1H**2))], [p2H**2*p12C**2 + 2*p12C*p13C*p1H*p2H*2 + p1H**2*p13C**2, pur_13C*(2*p1H*p2H*p12C**2+2*p12C*p13C*p1H**2) + pur_12C*(p2H**2*p12C**2+2*p12C*p13C*p1H*p2H*2+p1H**2*p13C**2), pur_12C*(pur_13C*(2*p1H*p2H*p12C**2+2*p12C*p13C*p1H**2) + pur_12C*(p2H**2*p12C**2+2*p12C*p13C*p1H*p2H*2+p1H**2*p13C**2)) + pur_13C*(pur_13C*(p1H**2*p12C**2) + pur_12C*(2*p1H*p2H*p12C**2 + 2*p12C*p13C*p1H**2))]]'\n    , 'tracer_purity': [0.1, 0.9]}, {'comment':\n    '13C tracer, with derivative, no NA of the tracer element, with purity of the tracer element, tracer with 2 isotopes, correct for NA of 1 elements with 2 isotopes'\n    , 'formula': 'C2', 'derivative_formula': '', 'correct_NA_tracer': False,\n    'expected_matrix':\n    '[[1.0, 0.0, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]]', 'tracer_purity':\n    [0.0, 1.0]}])"
}